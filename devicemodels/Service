import("devicemodels.DeviceFactory")

/*	
 * 	A Service class is typically used by a protocol adaptor (http, ws, mqtt) to interact with Device models
 * 	The Service fetches a device model from the device repository based on @id and executes a @method passing @params		
 */

var Service = Class({
  constructor: function(adaptor) {
    this.adaptor = adaptor
    this.factory = new devicemodels.DeviceFactory({adaptor: adaptor})
  },
  
  execute: function(id, method, params) {
	// fetch deviceModel by DeviceID from device Database, load will pick ID from request.
  	// This is important to retrieve the device classname and instantiate the proper device class for the model 
    
    try {
      var device = this.factory.load(id)  

      // If device model exists
      if (device) {
        // invoke desired method
        device[method](params)

        return device
      }
    } catch(e) {
      logger.error("Service - ", e)
    }
    
    return null
  }
})

