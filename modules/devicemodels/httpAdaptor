/*
 *  httpAdaptor provides an HTTP endpoint to the devicemodels.Service class, marshalling request parameters and returning response 
 *	it also injects a deviceRepositoryAdaptor that will provide the underlying repository services
 */
require("/modules/framr/Framr").init(this, {classPath: "./modules/;./modules/devicemodels/demoApp/", quiet: true})

import("devicemodels.Service")
import("agnes.DeviceRepositoryAdaptor")

if (!request.parameters.id) logger.error("id missing in request parameters.")
if (!request.parameters.method) logger.warn("method missing in request parameters.")
//log params
 logger.debug("httpAdapter -  request.parameters",  request.parameters)

// Remove unnecessary id & method from request object to pass to service
var params = {}
for (var k in request.parameters) params[k] = request.parameters[k]
delete params.id
delete params.method

// Instantiate Service with a repository adaptor
var service = new Service(new agnes.DeviceRepositoryAdaptor())

// This pulls device model by -id- from device repository and executes -method- passing to it -params
var exeParams={id:request.parameters.id};
if(request.parameters.cls){
    exeParams.cls=request.parameters.cls;
}
if(request.parameters.name){
    exeParams.name=request.parameters.name;
}

var device = service.execute(exeParams,     request.parameters.method,     params)

return device?device.serialize():null
